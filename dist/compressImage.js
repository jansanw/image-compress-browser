!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.compressImage=e()}(this,function(){"use strict";function t(){!function(t){var e=t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype,n=t.Blob&&function(){try{return Boolean(new Blob)}catch(t){return!1}}(),a=n&&t.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(t){return!1}}(),r=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder,i=(n||r)&&t.atob&&t.ArrayBuffer&&t.Uint8Array&&function(t){var e,i,o,u,f,c,l,d,s;if(!(e=t.match(/^data:((.*?)(;charset=.*?)?)(;base64)?,/)))throw new Error("invalid data URI");for(i=e[2]?e[1]:"text/plain"+(e[3]||";charset=US-ASCII"),o=!!e[4],u=t.slice(e[0].length),f=o?atob(u):decodeURIComponent(u),c=new ArrayBuffer(f.length),l=new Uint8Array(c),d=0;d<f.length;d+=1)l[d]=f.charCodeAt(d);return n?new Blob([a?l:c],{type:i}):(s=new r,s.append(c),s.getBlob(i))};t.HTMLCanvasElement&&!e.toBlob&&(e.mozGetAsFile?e.toBlob=function(t,n,a){t(a&&e.toDataURL&&i?i(this.toDataURL(n,a)):this.mozGetAsFile("blob",n))}:e.toDataURL&&i&&(e.toBlob=function(t,e,n){t(i(this.toDataURL(e,n)))})),"function"==typeof define&&define.amd?define(function(){return i}):"object"==typeof module&&module.exports?module.exports=i:t.dataURLtoBlob=i}(window)}function e(t,e,n){for(var a="",r=e;r<e+n;r++)a+=String.fromCharCode(t.getUint8(r));return a}function n(t,n){if("Exif"!=e(t,n,4))return!1;var a=n+6,r=!1;if(18761==t.getUint16(a))r=!1;else{if(19789!=t.getUint16(a))return!1;r=!0}if(42!=t.getUint16(a+2,!r))return!1;var i=t.getUint32(a+4,!r);if(i<8)return!1;for(var o,u=a+i,f=t.getUint16(u,!r),c=0;c<f;c++){o=u+2+12*c;if(274==t.getUint16(o,!r)){var l=t.getUint16(o+2,!r),d=t.getUint32(o+4,!r);t.getUint32(o+8,!r);if(3===l&&1===d)return t.getUint16(o+8,!r)}}return!1}function a(t){var e=new DataView(t);if(255!=e.getUint8(0)||216!=e.getUint8(1))return!1;for(var a=2,r=t.byteLength;a<r;){if(255!=e.getUint8(a))return!1;if(225==e.getUint8(a+1))return n(e,a+4);a+=2+e.getUint16(a+2)}return!1}function r(t,e){var n=new FileReader;n.onload=function(t){var n=a(t.target.result);e(n)},n.readAsArrayBuffer(t)}function i(t,e){var n=window.URL||window.webkitURL,a=n.createObjectURL(t),r=new Image;r.onload=function(){e(r)},r.src=a}function o(e,n,a){t();var r=e.naturalWidth||e.width,i=e.naturalHeight||e.height;n&&"5678".indexOf(n)>-1&&(r=e.naturalHeight||e.height,i=e.naturalWidth||e.width);var o=r*i/1e6;o>1?(o=Math.sqrt(o),r/=o,i/=o):o=1;var u=document.createElement("canvas");u.width=r,u.height=i;var f=u.getContext("2d");switch(f.clearRect(0,0,r,i),f.save(),n){case 3:f.rotate(180*Math.PI/180),f.drawImage(e,-r,-i,r,i);break;case 6:f.rotate(90*Math.PI/180),f.drawImage(e,0,-r,i,r);break;case 8:f.rotate(270*Math.PI/180),f.drawImage(e,-i,0,i,r);break;case 2:f.translate(r,0),f.scale(-1,1),f.drawImage(e,0,0,r,i);break;case 4:f.translate(r,0),f.scale(-1,1),f.rotate(180*Math.PI/180),f.drawImage(e,-r,-i,r,i);break;case 5:f.translate(r,0),f.scale(-1,1),f.rotate(90*Math.PI/180),f.drawImage(e,0,-r,i,r);break;case 7:f.translate(r,0),f.scale(-1,1),f.rotate(270*Math.PI/180),f.drawImage(e,-i,0,i,r);break;default:f.drawImage(e,0,0,r,i)}f.restore(),u.toBlob(function(t){a(t,r,i)},"image/jpeg",.75)}function u(t,e){var n=t||{},a=e||function(){};if("image/jpeg"!==n.type)return a(t);i(n,function(e){e?r(n,function(r){r=r||1,r?o(e,r,function(t,e,r){var i=n.size<=t.size,o=t;i&&(o=n),a(o)}):a(t)}):a(t)})}return u});
